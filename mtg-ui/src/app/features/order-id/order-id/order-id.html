<div class="orders-container">
  <h2>Order Management</h2>

  <app-order-form (orderCreated)="onOrderCreated()"></app-order-form>

  <div class="order-search">
    <h3>Search Orders</h3>
    <input type="text" placeholder="Search..."
      (input)="orderSearch.set($any($event.target).value)"
      [value]="orderSearch()">
  </div>

  @if (filteredOrders().length > 0) {
    <ul>
      @for (order of filteredOrders(); track $index) {
        <li class="order-item">
          <div class="order-row">

            <app-order-detail [order]="order"></app-order-detail>

            <div class="order-actions">
              <select 
                [value]="order.status"
                (change)="updateStatus(order.orderId, $any($event.target).value)">
                <option value="Pending">Pending</option>
                <option value="Paid">Paid</option>
                <option value="Fulfilled">Fulfilled</option>
                <option value="Canceled">Canceled</option>
              </select>

              <button class="edit-btn" (click)="selectOrder(order.orderId)">Edit Contents</button>
              <button class="delete-btn" (click)="deleteOrder(order.orderId)">Delete</button>
            </div>

          </div>
        </li>
      }
    </ul>
  } @else {
    <p>No orders found.</p>
  }
</div>

@if (selectedOrder(); as activeOrder) {
  <div class="order-items-panel">
    <div class="panel-header">
      <h3>Editing Order #{{ activeOrder.orderId }}</h3>
      <button (click)="selectOrder()" class="close-btn">Close</button>
    </div>

    <div class="add-item-form">
      <h4>Add Item to Order</h4>
      <div class="form-row">
        <div class="form-field">
          <label>Card Number</label>
          <input type="text" 
            placeholder="e.g., 123"
            (input)="editCardNumber.set($any($event.target).value)"
            [value]="editCardNumber()">
        </div>
        <div class="form-field">
          <label>Set Name</label>
          <input type="text" 
            placeholder="e.g., DMU"
            (input)="editSetName.set($any($event.target).value)"
            [value]="editSetName()">
        </div>
        <div class="form-field">
          <label>Quantity</label>
          <input type="number" 
            min="1"
            placeholder="1"
            (input)="editQuantity.set(+$any($event.target).value)"
            [value]="editQuantity()">
        </div>
        <div class="form-field">
          <label>Price (each)</label>
          <input type="number" 
            step="0.01"
            min="0"
            placeholder="0.00"
            (input)="editPrice.set(+$any($event.target).value)"
            [value]="editPrice()">
        </div>
      </div>
      <button (click)="addCardItemToOrder()" class="add-btn">Add to Order</button>
    </div>

    <div class="current-items">
      <h4>Current Items</h4>
      @if (activeOrder.items.length > 0) {
        <ul>
          @for (item of activeOrder.items; track $index) {
            <li>
              <span class="item-name">{{ item.itemName }}</span>
              <span class="price">{{ item.unitPrice | currency }}</span>
              <button (click)="removeItemFromSelectedOrder($index)" class="remove-btn">Remove</button>
            </li>
          }
        </ul>
        <div class="total">
          <strong>Total: {{ activeOrder.totalPrice | currency }}</strong>
        </div>
      } @else {
        <p class="no-items">No items in this order yet.</p>
      }
    </div>
  </div>
}
