<div class="order-input-box">
  <h3>Paste Order Items</h3>

  <textarea [(ngModel)]="pastedText" rows="5"
    placeholder="Paste customer email order list here..."></textarea>

  <button (click)="appendPastedItems()">Add to Orders List</button>
</div>

<div class="orders-container">
  <h2>Order Management</h2>

  <app-order-form (orderCreated)="onOrderCreated()"></app-order-form>

  <div class="order-search">
    <input type="text" placeholder="Search..."
      (input)="orderSearch.set($any($event.target).value)"
      [value]="orderSearch()">
  </div>

  @if (filteredOrders().length > 0) {
    <ul>
      @for (order of filteredOrders(); track $index) {
        <li class="order-item">
          <div class="order-row">

            <app-order-detail [order]="order"></app-order-detail>

            <div class="order-actions">
              <select 
                [value]="order.status"
                (change)="updateStatus(order.orderId, $any($event.target).value)">
                <option value="Pending">Pending</option>
                <option value="Paid">Paid</option>
                <option value="Fulfilled">Fulfilled</option>
                <option value="Canceled">Canceled</option>
              </select>

              <button (click)="selectOrder(order.orderId)">Edit Contents</button>
              <button (click)="deleteOrder(order.orderId)">Delete</button>
            </div>

          </div>
        </li>
      }
    </ul>
  } @else {
    <p>No orders found.</p>
  }
</div>

@if (selectedOrder(); as activeOrder) {
  <div class="order-items-panel">
    <h3>Editing: {{ activeOrder.orderId }}</h3>

    <button (click)="selectOrder()">Close</button>

    <h4>Add Item</h4>
    <input type="text" placeholder="Item"
      (input)="editItemName.set($any($event.target).value)"
      [value]="editItemName()">

    <input type="number" placeholder="Price"
      (input)="editItemPrice.set($any($event.target).value)"
      [value]="editItemPrice()">

    <button (click)="addItemToSelectedOrder()">Add</button>

    <ul>
      @for (item of activeOrder.items; track $index) {
        <li>
          {{ item.itemName }} - {{ item.unitPrice }}
          <button (click)="removeItemFromSelectedOrder($index)">Remove</button>
        </li>
      }
    </ul>

    <strong>Total: {{ activeOrder.totalPrice }}</strong>
  </div>
}
